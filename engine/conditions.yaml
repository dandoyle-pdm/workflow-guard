# =============================================================================
# Claude Hooks Engine - Conditions Library
# =============================================================================
# Reusable condition definitions that can be referenced in rules.
# =============================================================================

version: "1.0"

conditions:
  # ===========================================================================
  # TOOL TYPE DETECTION
  # ===========================================================================

  is-bash-tool:
    type: equals
    field: tool_name
    value: Bash
    description: "Matches Bash tool"

  is-write-tool:
    type: compound
    any:
      - type: equals
        field: tool_name
        value: Edit
      - type: equals
        field: tool_name
        value: Write
      - type: equals
        field: tool_name
        value: MultiEdit
      - type: equals
        field: tool_name
        value: NotebookEdit
    description: "Matches file-writing tools"

  # ===========================================================================
  # BASH COMMAND PATTERNS
  # ===========================================================================

  is-output-redirect:
    type: regex
    field: tool_input.command
    pattern: '>\s*[^>|&]'
    description: "Detects output redirection (>)"

  is-append-redirect:
    type: regex
    field: tool_input.command
    pattern: '>>'
    description: "Detects append redirection (>>)"

  is-any-redirect:
    type: compound
    any:
      - ref: is-output-redirect
      - ref: is-append-redirect

  is-destructive-rm:
    type: regex
    field: tool_input.command
    pattern: 'rm\s+.*-[rf]'
    flags: [ignorecase]
    description: "Detects rm with -r or -f flags"

  is-sudo-command:
    type: regex
    field: tool_input.command
    pattern: '\bsudo\s+'
    description: "Detects sudo usage"

  is-tee-command:
    type: regex
    field: tool_input.command
    pattern: '\btee\s+'
    description: "Detects tee command"

  is-sed-inplace:
    type: regex
    field: tool_input.command
    pattern: '\bsed\b.*-i'
    description: "Detects sed with in-place flag"

  is-heredoc:
    type: regex
    field: tool_input.command
    pattern: '<<\s*[''"]?\w+[''"]?'
    description: "Detects heredoc patterns"

  is-cat-redirect:
    type: regex
    field: tool_input.command
    pattern: '\bcat\b.*>\s*'
    description: "Detects cat > file patterns"

  is-echo-redirect:
    type: regex
    field: tool_input.command
    pattern: '\becho\b.*>\s*'
    description: "Detects echo > file patterns"

  is-bash-file-write:
    type: compound
    any:
      - ref: is-output-redirect
      - ref: is-append-redirect
      - ref: is-heredoc
      - ref: is-tee-command
      - ref: is-sed-inplace
      - ref: is-cat-redirect
      - ref: is-echo-redirect
    description: "Matches any Bash file write pattern"

  # ===========================================================================
  # BASH READ PATTERNS (for observation, not blocking)
  # ===========================================================================

  is-cat-command:
    type: regex
    field: tool_input.command
    pattern: '\bcat\s+'
    description: "Detects cat command (file reading)"

  is-head-command:
    type: regex
    field: tool_input.command
    pattern: '\bhead\s+'
    description: "Detects head command (file reading)"

  is-tail-command:
    type: regex
    field: tool_input.command
    pattern: '\btail\s+'
    description: "Detects tail command (file reading)"

  is-less-command:
    type: regex
    field: tool_input.command
    pattern: '\bless\s+'
    description: "Detects less command (file reading)"

  is-grep-command:
    type: regex
    field: tool_input.command
    pattern: '\bgrep\s+'
    description: "Detects grep command (file searching)"

  is-bash-file-read:
    type: compound
    any:
      - ref: is-cat-command
      - ref: is-head-command
      - ref: is-tail-command
      - ref: is-less-command
      - ref: is-grep-command
    description: "Matches any Bash file read pattern (observe only, not blocking)"

  # ===========================================================================
  # FILE PATH PATTERNS
  # ===========================================================================

  is-code-file:
    type: regex
    field: tool_input.file_path
    pattern: '\.(go|py|sh|js|ts|tsx|jsx)$'
    description: "Matches code files by extension"

  is-tickets-path:
    type: regex
    field: tool_input.file_path
    pattern: '/tickets/'
    description: "Matches files in tickets directories"

  is-test-file:
    type: regex
    field: tool_input.file_path
    pattern: '(_test\.go|test_.*\.py|\.test\.(js|ts|tsx)|\.spec\.(js|ts|tsx))$'
    description: "Matches test files"

  is-env-file:
    type: glob
    field: tool_input.file_path
    pattern: "**/.env*"
    description: "Matches .env files"

  is-git-internal:
    type: glob
    field: tool_input.file_path
    pattern: "**/.git/**"
    description: "Matches .git internal files"

  # ===========================================================================
  # UTILITY CONDITIONS
  # ===========================================================================

  has-file-path:
    type: exists
    field: tool_input.file_path
    description: "True if event has a file_path"

  has-command:
    type: exists
    field: tool_input.command
    description: "True if event has a command"

  skip-confirmation-enabled:
    type: equals
    field: env.SKIP_EDIT_CONFIRMATION
    value: "true"
    description: "Bypass when SKIP_EDIT_CONFIRMATION=true"
